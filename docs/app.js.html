<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>app.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.exports.html">exports</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module.exports.html#getAdminRecipients">getAdminRecipients</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#getSectionInstructorRecipient">getSectionInstructorRecipient</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#isAdmin">isAdmin</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#isInstructor">isInstructor</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#isStudent">isStudent</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#send">send</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#sendToAdmins">sendToAdmins</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#sendToSectionInstructor">sendToSectionInstructor</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#.ensureAuthenticated">ensureAuthenticated</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#.forwardIfAuthenticated">forwardIfAuthenticated</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#.isAdmin">isAdmin</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#.isAuthenticated">isAuthenticated</a></li><li data-type='method' style='display: none;'><a href="module.exports.html#.isInstructor">isInstructor</a></li></ul></li><li></li></ul><h3>Modules</h3><ul><li><a href="module-app.html">app</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-app.html#.setviewengine">set view engine</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.use404errorhandler">use 404 error handler</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.usecookieSession">use cookieSession</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.usecors">use cors</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.useejsLayouts">use ejsLayouts</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.usejson">use json</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.usepassport">use passport</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.useurlencoded">use urlencoded</a></li></ul></li><li><a href="module-routes_admin.html">routes/admin</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.DELETE/deleteSection/:id/:length">DELETE /deleteSection/:id/:length</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.GET/resetPtracker">GET /resetPtracker</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.GET/userDelete/:id">GET /userDelete/:id</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.GETadmin/">GET admin/</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.POST/addSection">POST /addSection</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.POST/changeRole">POST /changeRole</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.POST/changeSectionInstructor">POST /changeSectionInstructor</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.POST/deletePtrackerData">POST /deletePtrackerData</a></li><li data-type='method' style='display: none;'><a href="module-routes_admin.html#.POST/siteDelete/:id">POST /siteDelete/:id</a></li></ul></li><li><a href="module-routes_authRoutes.html">routes/authRoutes</a></li><li><a href="module-routes_dataRoutes.html">routes/dataRoutes</a></li><li><a href="module-routes_emailRoutes.html">routes/emailRoutes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/changeEmailStatus/:userId">POST email/changeEmailStatus/:userId</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/instructorDeleted">POST email/instructorDeleted</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/newUser">POST email/newUser</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/shiftCreated">POST email/shiftCreated</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/shiftDeleted">POST email/shiftDeleted</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/shiftUpdated">POST email/shiftUpdated</a></li><li data-type='method' style='display: none;'><a href="module-routes_emailRoutes.html#.POSTemail/userAssignedSection">POST email/userAssignedSection</a></li></ul></li><li><a href="module-routes_indexRoutes.html">routes/indexRoutes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-routes_indexRoutes.html#~convertMonth">convertMonth</a></li><li data-type='method' style='display: none;'><a href="module-routes_indexRoutes.html#~findMainSite">findMainSite</a></li><li data-type='method' style='display: none;'><a href="module-routes_indexRoutes.html#~findNameOfSite">findNameOfSite</a></li><li data-type='method' style='display: none;'><a href="module-routes_indexRoutes.html#~getShifts">getShifts</a></li></ul></li><li><a href="module-routes_instructorRoutes.html">routes/instructorRoutes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-routes_instructorRoutes.html#.GETinstructor/">GET instructor/</a></li><li data-type='method' style='display: none;'><a href="module-routes_instructorRoutes.html#.POSTinstructor/changeSection">POST instructor/changeSection</a></li></ul></li><li><a href="module-routes_shiftRoutes.html">routes/shiftRoutes</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-routes_shiftRoutes.html#.DELETE/shifts/delete/:id">DELETE /shifts/delete/:id</a></li><li data-type='method' style='display: none;'><a href="module-routes_shiftRoutes.html#.POST/shifts/">POST /shifts/</a></li><li data-type='method' style='display: none;'><a href="module-routes_shiftRoutes.html#.PUT/shifts/:id">PUT /shifts/:id</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#flashMessages">flashMessages</a></li><li><a href="global.html#main">main</a></li><li><a href="global.html#ndaChecker">ndaChecker</a></li><li><a href="global.html#passUser">passUser</a></li><li><a href="global.html#sectionChecker">sectionChecker</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">app.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileOverview This module represents the entry point for the application. It sets up the middleware, routes, and logging for the application.
 * @module app
 * @requires dotenv
 * @requires http-errors
 * @requires path
 * @requires express
 * @requires cookie-session
 * @requires express-session
 * @requires express-ejs-layouts
 * @requires ./auth/passport
 * @requires ./middleware/passUser
 * @requires ./middleware/flashMessages
 * @requires ./middleware/sectionChecker
 * @requires ./middleware/ndaChecker
 * @requires ./routes/authRoutes
 * @requires ./routes/indexRoutes
 * @requires ./routes/shiftRoutes
 * @requires ./routes/dataRoutes
 * @requires ./routes/adminRoutes
 * @requires ./routes/emailRoutes
 * @requires ./routes/instructorRoutes
 * @requires method-override
 * @requires morgan
 * @requires cors
 */

require('dotenv').config();
const createError = require('http-errors');
const path = require('path');
const express = require('express');
const cookieSession = require('cookie-session');
const session = require('express-session');
const ejsLayouts = require('express-ejs-layouts');
const passport = require('./auth/passport');
const passUser = require('./middleware/passUser');
const flashMessages = require('./middleware/flashMessages');
const sectionChecker = require('./middleware/sectionChecker');
const ndaChecker = require('./middleware/ndaChecker');
const authRouter = require('./routes/authRoutes');
const indexRouter = require('./routes/indexRoutes');
const shiftRouter = require('./routes/shiftRoutes');
const dataRouter = require('./routes/dataRoutes');
const adminRouter = require('./routes/adminRoutes');
const emailRouter = require('./routes/emailRoutes');
const instructorRouter = require('./routes/instructorRoutes');
const methodOverride = require('method-override');
const logger = require('morgan');
const cors = require('cors');

const app = express();

// const {PrismaClient} = require('@prisma/client');
// const prisma = new PrismaClient();
// const User = require('../models/user');

// const initializePassport = require('./auth/passport')
// initializePassport(
//     passport,
//     email => prisma.user.find(user => user.email === email),
//     id => prisma.user.findUnique(user => user.id)
// )

/**
 * Import passport library.
 * @const {Object} passport
 * @see {@link https://www.npmjs.com/package/passport}
 */

require('./auth/passport');
app.use(methodOverride('_method'));
app.use(express.static(path.join(__dirname, 'public'), { redirect: true }));

if (process.env.NODE_ENV !== 'test') {
app.use(logger('dev'));
}

/**
 * Use ejsLayouts for the views.
 * @name use ejsLayouts
 * @function
 * @memberof module:app
 */

app.use(ejsLayouts);

/**
 * Use JSON body parsing.
 * @name use json
 * @function
 * @memberof module:app
 */

app.use(express.json());

/**
 * Use urlencoded body parsing.
 * @name use urlencoded
 * @function
 * @memberof module:app
 */

app.use(express.urlencoded({ extended: false }));

/**
 * Set the view engine to EJS.
 * @name set view engine
 * @function
 * @memberof module:app
 */

app.set('view engine', 'ejs');


app.use(cookieSession({
maxAge: 24 * 60 * 60 * 1000,
keys: [process.env.COOKIE_KEY],
}));

/**
 * Use cors.
 * @name use cors
 * @function
 * @memberof module:app
 */


app.use(cors());

/**
 * Use cookieSession.
 * @name use cookieSession
 * @function
 * @memberof module:app
 */


app.use(cookieSession({
secret: 'melody hensley is my spirit animal',
resave: false,
saveUninitialized: false,
cookie: {
httpOnly: true,
secure: false,
maxAge: 24 * 60 * 60 * 1000
}
}));


/**
 * Initialize Passport and use it for authentication.
 * @name use passport
 * @function
 * @memberof module:app
 */

app.use(passport.initialize());
app.use(passport.session());


app.use(passUser);
// app.post('/auth/login',
//     passport.authenticate('local', { failureRedirect: '/login', failureMessage: 'auth failed' }),
//     function (req, res) {
//         res.redirect('/dashboard');
//     });
app.use(flashMessages);
// app.use(sectionChecker);
// app.use(ndaChecker);

//Set up routes
app.use('/', indexRouter);
app.use('/shifts', shiftRouter);
app.use('/auth', authRouter);
app.use('/data', dataRouter);
app.use('/admin', adminRouter);
app.use('/email', emailRouter);
app.use('/instr_panel', instructorRouter);

/**
 * Handle 404 errors.
 * @name use 404 error handler
 * @function
 * @memberof module:app
 */

app.use((req, res, next) => {
next(createError(404));
});

module.exports = app;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Fri Mar 31 2023 01:25:01 GMT-0700 (Pacific Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
